<div class="sale-report">
    <div class="operate-bar" [ngClass]="{'extend-conditions': extendConditions}">
        <div class="operate-item">
            <span>时间: </span>
            <app-range-data [(startDate)]="searchParams.filters.beginTime" [(endDate)]="searchParams.filters.endTime"></app-range-data>
        </div>

        <div class="operate-item btn-groups">
            <button nz-button (click)="searchData()" nzType="primary">
                <i class="iconfont fxsousuo"></i> 搜索
            </button>
            <button nz-button (click)="resetFilters()">
                <i class="iconfont fxreset"></i> 重置
            </button>
            <nz-badge [nzCount]="0">
                <button nz-button nzType="default" (click)="extendConditions = !extendConditions">
                    <i nz-icon nzType="down" nzTheme="outline"></i> 更多
                </button>
            </nz-badge>
        </div>

        <div class="operate-item">
            <span>商品: </span>
            <input type="text" nz-input [(ngModel)]="searchParams.filters.keyword" placeholder="请输入商品名称/拼音简拼/条码" />
        </div>

        <div class="operate-item">
            <span>商品分类: </span>
            <nz-cascader nzChangeOnSelect (ngModelChange)="changeCateList($event)" [nzOptions]="categoryList" nzPlaceHolder="请选择分类"
                [(ngModel)]="searchParams.filters.cateList">
            </nz-cascader>
        </div>
    </div>

    <div class="container">
        <app-ufast-table-nav [rightTemplate]="rightNav">
        </app-ufast-table-nav>
        <ng-template #rightNav>
            <nz-button-group>
                <button style="margin: 0;border-right: 0;border-radius: 2px;" class="refresh m-r-sm" nz-button (click)="searchData()">
                    <i class="icon" nz-icon type="sync" theme="outline"></i>
                </button>
                <button style="margin: 0;" class="refresh m-r-xs" nz-button appDownload [downloadUrl]="exportParam.downloadUrl"
                    [method]="exportParam.reqMethod" [reqParam]="exportParam.fileParam" [downloadServer]="exportParam.downloadServer"
                    [fileName]="exportParam.fileName">
                    <i nz-icon type="upload" theme="outline"></i>
                </button>
            </nz-button-group>
        </ng-template>

        <nz-table class="list-table" #colSpanTable [nzData]="dataList" nzBordered="true" (nzPageIndexChange)="getTbData()" nzSize="small"
            [nzFrontPagination]="false" (nzPageSizeChange)="getTbData()" [nzTotal]="tbInfoObj.totalNum" nzShowSizeChanger
            [(nzPageIndex)]="searchParams.pageNum" [(nzPageSize)]="searchParams.pageSize">
            <thead>
                <tr>
                    <th class="text-center" nzWidth="50">序号</th>
                    <th class="text-center" nzWidth="300">商品名称</th>
                    <th class="text-center" nzWidth="150">规格</th>
                    <th class="text-center" nzWidth="150">商品条码</th>
                    <th class="text-center" nzWidth="100">单位</th>
                    <th class="text-center" nzWidth="110">原价(￥)</th>
                    <th class="text-center" nzWidth="130">销售均价(￥)</th>
                    <th class="text-center" nzWidth="130">销售数量</th>
                    <th class="text-center" nzWidth="130">销售金额(￥)</th>
                    <th class="text-center" nzWidth="130">销售成本(￥)</th>
                    <th class="text-center" nzWidth="110">销售利润(￥)</th>
                    <th class="text-center" nzWidth="110">利润率(%)</th>
                    <th class="text-center" nzWidth="110">退货数量</th>
                    <th class="text-center" nzWidth="110">退货金额(￥)</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of colSpanTable.data; index as i">
                    <td class="text-center">{{ data.rowNum }}</td>
                    <td>{{ data.productName }} </td>
                    <td>{{ data.specification }}</td>
                    <td class="text-center">{{ data.barcode }}</td>
                    <td class="text-center">{{ data.uomName }}</td>
                    <td class="text-right">{{ data.salePrice }}</td>
                    <td class="text-right">{{ data.averageSalePrice }}</td>
                    <td class="text-right">{{ data.totalSaleQty }}</td>
                    <td class="text-right">{{ data.totalSaleAmount }}</td>
                    <td class="text-right">{{ data.totalSaleCostAmount }}</td>
                    <td class="text-right">{{ data.totalSaleProfit }}</td>
                    <td class="text-right">{{ data.totalSaleProfitRate }}</td>
                    <td class="text-right">{{ data.totalSaleReturnQty }}</td>
                    <td class="text-right">{{ data.totalSaleReturnAmount }}</td>
                </tr>
                <tr class="deep-back" *ngIf="dataList.length > 0">
                    <td class="text-left" colspan="7">小计：</td>
                    <td class="text-right">{{ subTotalInfo.saleQty }}</td>
                    <td class="text-right">{{ subTotalInfo.saleAmount }}</td>
                    <td class="text-right">{{ subTotalInfo.saleCostAmount }}</td>
                    <td class="text-right">{{ subTotalInfo.saleProfit }}</td>
                    <td class="text-right">{{ subTotalInfo.saleProfitRate }}</td>
                    <td class="text-right">{{ subTotalInfo.saleReturnQty }}</td>
                    <td class="text-right">{{ subTotalInfo.saleReturnAmount }}</td>
                </tr>
                <tr class="deep-back" *ngIf="dataList.length > 0">
                    <td class="text-left" colspan="7">总计：</td>
                    <td class="text-right">{{ subTotalInfo.saleQty }}</td>
                    <td class="text-right">{{ subTotalInfo.saleAmount }}</td>
                    <td class="text-right">{{ subTotalInfo.saleCostAmount }}</td>
                    <td class="text-right">{{ subTotalInfo.saleProfit }}</td>
                    <td class="text-right">{{ subTotalInfo.saleProfitRate }}</td>
                    <td class="text-right">{{ subTotalInfo.saleReturnQty }}</td>
                    <td class="text-right">{{ subTotalInfo.saleReturnAmount }}</td>
                </tr>
            </tbody>
        </nz-table>
    </div>
</div>
