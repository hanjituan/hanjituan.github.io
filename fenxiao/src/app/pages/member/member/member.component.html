<div class="goods-wraper">
    <ng-container *ngIf="currentPage===pageType.List">
        <div class="operate-bar" [ngClass]="{'extend-conditions': extendConditions}">
            <div class="operate-item">
                <span>会员：</span>
                <nz-input-group [nzPrefix]="prefixTemplateUser">
                    <input type="text" nz-input placeholder="请输入会员名称/手机号" [(ngModel)]="filters.keyword" />
                </nz-input-group>
                <ng-template #prefixTemplateUser><i nz-icon nzType="search"></i></ng-template>
            </div>
            <div class="operate-item">
                <span>会员状态：</span>
                <nz-select nzShowSearch nzAllowClear nzPlaceHolder="请选择" [(ngModel)]="filters.state">
                    <nz-option nzLabel="全部" nzValue=""></nz-option>
                    <nz-option nzLabel="已锁定" nzValue="1"></nz-option>
                    <nz-option nzLabel="正常" nzValue="0"></nz-option>
                </nz-select>
            </div>
            <div class="operate-item btn-groups">
                <button nz-button (click)="searchByCondition()" nzType="primary">
                    <i class="iconfont fxsousuo"></i>
                    搜索</button>
                <button nz-button (click)="resetCondition()">
                    <i class="iconfont fxreset"></i>
                    重置
                </button>
                <nz-badge [nzCount]="0">
                    <button nz-button nzType="default" (click)="extendConditions = !extendConditions">
                        <i *ngIf="!extendConditions" nz-icon nzType="down" nzTheme="outline"></i>
                        <i *ngIf="extendConditions" nz-icon nzType="up" nzTheme="outline"></i>
                        更多
                    </button>
                </nz-badge>
            </div>
            <div class="operate-item" style="margin-top: 9px;">
                <span> 创建时间：</span>
                <app-range-data [hiddenBtn]="true" [(startDate)]="filters.start" [(endDate)]="filters.end">
                </app-range-data>
            </div>
        </div>

        <div class="container">
            <app-ufast-table-nav [tableConfig]="tableConfig" [leftTemplate]="leftNav" [rightTemplate]="rightNav">
            </app-ufast-table-nav>

            <ng-template #leftNav>
                <button nz-button nzType="primary" (click)="bonusPoints(true)">赠送积分</button>
                <button nz-button (click)="bonusPoints(false)">扣减积分</button>
                <button nz-button (click)="isLock(false)"> 锁定 </button>
                <button nz-button (click)="isLock(true)">解锁</button>
            </ng-template>

            <ng-template #rightNav>
                <nz-button-group>
                    <button class="refresh" nz-button (click)="getDataList()">
                        <i class="icon" nz-icon type="sync" theme="outline"></i>
                    </button>
                    <button style="border-right: 1px solid #dddddd; " class="refresh" nz-button appDownload
                        [downloadUrl]="productExportParam.downloadUrl" [method]="productExportParam.reqMethod"
                        [reqParam]="productExportParam.fileParam" [fileName]="productExportParam.fileName"
                        [downloadServer]="productExportParam.downloadServer">
                        <i nz-icon type="upload" theme="outline"></i>
                    </button>
                </nz-button-group>
            </ng-template>

            <app-ufast-table [tableConfig]=" tableConfig" (selectedChange)="checkTableItem($event)"
                [dataList]="dataList" (updateList)="getDataList($event)" (sortChange)="sortOrderBy($event)">
            </app-ufast-table>

            <ng-template #seqNoTpl let-index="_index">
                {{index + 1}}
            </ng-template>

            <ng-template #operationTpl let-item="_item">
                <button class="primary-color" nz-button nzType="link" (click)="enableGoods(item.id,item.state)">
                    <i *ngIf="item.state" class="iconfont fxstop"></i>
                    <i *ngIf="!item.state" class="iconfont fxenable"></i>
                    {{!item.state ? '锁定' : '解锁'}}
                </button>
            </ng-template>

            <ng-template #stateTpl let-item="_item">
                <span>{{!item.state ? '正常' : '已锁定'}}</span>
            </ng-template>

            <ng-template #memberNoTpl let-item="_item">
                <span class="primary-color" (click)="openDialog(item)">{{item.memberNo}}</span>
            </ng-template>

            <ng-template #integraTpl let-item="_item">
                <span class="primary-color" (click)="changePageType(item)">{{item.integration}}</span>
            </ng-template>
        </div>
    </ng-container>


    <ng-container *ngIf="currentPage===pageType.Add">
        <app-integral-detail [id]="itemObj" (returnBack)="returnToList($event)"></app-integral-detail>
    </ng-container>


    <nz-modal class="interModal" [(nzVisible)]="isVisible" [nzTitle]="modalTitle" (nzOnCancel)="handleCancel()"
        (nzOnOk)="handleOk()">
        <form nz-form [formGroup]="validateForm" (ngSubmit)="submitForm()">
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="name">会员名称</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="请输入会员名称">
                    <input nz-input formControlName="name" id="name" placeholder="请输入会员名称" />
                </nz-form-control>
            </nz-form-item>
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="integral">当前积分</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="请输入当前积分">
                    <input nz-input formControlName="integral" id="integral" placeholder="请输入当前积分" />
                </nz-form-control>
            </nz-form-item>
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="cutIntegral">{{modalTitle}}</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="'请输入' + modalTitle">
                    <nz-input-number formControlName="cutIntegral" [nzStep]="1" id="cutIntegral" [nzMax]='999999999'
                        [nzPlaceHolder]="'请输入' + modalTitle" (nzBlur)="transformNum()">
                    </nz-input-number>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="note">备注</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="请输入备注">
                    <textarea nz-input placeholder="请输入备注" ngModel formControlName="note" id="note" nzAutosize>
                    </textarea>
                </nz-form-control>
            </nz-form-item>
        </form>
    </nz-modal>

    <nz-modal [(nzVisible)]="memberDetailVisible" nzTitle="会员详情" (nzOnCancel)="memberDetailModalCancel()"
        (nzOnOk)="memberDetailModalhandleOk()">
        <ul class="detail-wraper">
            <li class="title">基本信息</li>
            <li class="base-info">
                <span class="li-label">会员编号：</span>
                <span>{{memberInfoDetail.memberNo}}</span>
            </li>
            <li class="base-info">
                <span class="li-label">会员姓名：</span>
                <span>{{memberInfoDetail.nickname}}</span>
            </li>
            <li class="base-info">
                <span class="li-label">手机号码：</span>
                <span>{{memberInfoDetail.phone}}</span>
            </li>
            <li class="base-info">
                <span class="li-label">积分：</span>
                <span>{{memberInfoDetail.integration}}</span>
            </li>
            <li class="base-info">
                <span class="li-label">注册时间：</span>
                <span>{{memberInfoDetail.createTime | map:'date:yyyy-MM-dd HH:mm:ss'}}</span>
            </li>
            <li class="title">实名认证</li>
            <li class="base-info">
                <span class="li-label">真实姓名：</span>
                <span>{{memberInfoDetail.name}}</span>
            </li>
            <li class="base-info">
                <span class="li-label">身份证号码：</span>
                <span>{{memberInfoDetail.idcardNo}}</span>
            </li>
        </ul>
    </nz-modal>
</div>